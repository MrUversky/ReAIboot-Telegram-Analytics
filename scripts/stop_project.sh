#!/bin/bash

# ReAIboot - –°–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ ReAIboot –ø—Ä–æ–µ–∫—Ç–∞..."
echo "================================="

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
stop_processes() {
    echo "üßπ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."
    # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞
    echo "üî® –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞..."
    pkill -9 -f "python.*run_api.py" 2>/dev/null && echo "‚úÖ API –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
    pkill -9 -f "scripts/run_api.py" 2>/dev/null && echo "‚úÖ API –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
    pkill -9 -f "npm.*run.*dev" 2>/dev/null && echo "‚úÖ npm –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

    # –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–æ—Ä—Ç—ã
    lsof -ti:8000 | xargs kill -9 2>/dev/null && echo "‚úÖ –ü–æ—Ä—Ç 8000 –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω"
    lsof -ti:3000 | xargs kill -9 2>/dev/null && echo "‚úÖ –ü–æ—Ä—Ç 3000 –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω"
    lsof -ti:3001 | xargs kill -9 2>/dev/null && echo "‚úÖ –ü–æ—Ä—Ç 3001 –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω"

    # –£–¥–∞–ª—è–µ–º PID —Ñ–∞–π–ª –∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏
    rm -f .running_pids 2>/dev/null && echo "‚úÖ PID —Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω"
    rm -f session_per.session* 2>/dev/null && echo "‚úÖ –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ —É–¥–∞–ª–µ–Ω—ã"
    rm -f telegram_session.session* 2>/dev/null && echo "‚úÖ Telegram —Å–µ—Å—Å–∏–∏ —É–¥–∞–ª–µ–Ω—ã"
}

# –í—ã–ø–æ–ª–Ω—è–µ–º –æ—Å—Ç–∞–Ω–æ–≤–∫—É
stop_processes

echo ""
echo "‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!"
echo "================================="
echo "–î–ª—è –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
echo "  ./start_project.sh"
