# ü§ñ LLM API

–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å AI: –∞–Ω–∞–ª–∏–∑ –ø–æ—Å—Ç–æ–≤, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏.

## –û–±–∑–æ—Ä

–†–∞–∑–¥–µ–ª `/api/llm` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫:
- –ê–Ω–∞–ª–∏–∑—É –ø–æ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ AI
- –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø—Ä–æ–º–ø—Ç–∞–º–∏
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é AI –º–æ–¥–µ–ª–µ–π

---

## –ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ—Å—Ç–∞

–ü—Ä–æ—Å—Ç–æ–π –∞–Ω–∞–ª–∏–∑ –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/llm/analyze-quick`

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** API Key

### Request Body

```json
{
  "text": "–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞",
  "channel_title": "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
  "views": 1234,
  "reactions": 56,
  "replies": 12,
  "forwards": 3
}
```

### Response

```json
{
  "success": true,
  "data": {
    "score": 8,
    "reason": "–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏",
    "suitable": true,
    "tokens_used": 245,
    "processing_time": 1.2,
    "model": "gpt-4o-mini"
  }
}
```

---

## –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å—Ç–∞: —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è ‚Üí –∞–Ω–∞–ª–∏–∑ ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/llm/process`

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** API Key

### Request Body

```json
{
  "posts": [
    {
      "id": "12345_@channel",
      "text": "–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞...",
      "channel_username": "@channel",
      "channel_title": "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞",
      "views": 1000,
      "reactions": 50,
      "replies": 10,
      "forwards": 2,
      "date": "2024-12-01T10:00:00Z"
    }
  ],
  "rubric": {
    "id": "instrument_dnya",
    "name": "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –î–Ω—è"
  },
  "reel_format": {
    "id": "talking_head",
    "name": "–ì–æ–≤–æ—Ä—è—â–∞—è –ì–æ–ª–æ–≤–∞"
  },
  "options": {
    "debug_mode": false,
    "step_by_step": false,
    "skip_filter": false,
    "skip_analysis": false
  }
}
```

### Response

```json
{
  "success": true,
  "data": {
    "results": [
      {
        "post_id": "12345_@channel",
        "filter": {
          "score": 8,
          "suitable": true,
          "reason": "–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ"
        },
        "analysis": {
          "success_factors": ["–§–∞–∫—Ç–æ—Ä 1", "–§–∞–∫—Ç–æ—Ä 2"],
          "audience_insights": ["–ò–Ω—Å–∞–π—Ç 1", "–ò–Ω—Å–∞–π—Ç 2"],
          "content_ideas": ["–ò–¥–µ—è 1", "–ò–¥–µ—è 2"]
        },
        "rubric_selection": {
          "selected_rubric": "instrument_dnya",
          "selected_format": "talking_head",
          "justification": "–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞"
        },
        "scenarios": [
          {
            "id": "scenario_123",
            "title": "–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è",
            "format": "talking_head",
            "duration": 60,
            "hook": {
              "text": "–¢–µ–∫—Å—Ç —Ö—É–∫–∞",
              "visual": "–û–ø–∏—Å–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª–∞",
              "voiceover": "–¢–µ–∫—Å—Ç –æ–∑–≤—É—á–∫–∏"
            },
            "insight": {
              "text": "–ö–ª—é—á–µ–≤–æ–π –∏–Ω—Å–∞–π—Ç",
              "visual": "–í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ",
              "voiceover": "–¢–µ–∫—Å—Ç –æ–∑–≤—É—á–∫–∏"
            },
            "steps": [
              {
                "step": 1,
                "title": "–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–≥–∞",
                "description": "–û–ø–∏—Å–∞–Ω–∏–µ",
                "visual": "–í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã",
                "voiceover": "–¢–µ–∫—Å—Ç –æ–∑–≤—É—á–∫–∏",
                "duration": 5
              }
            ],
            "cta": {
              "text": "–ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é",
              "visual": "–í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ",
              "voiceover": "–¢–µ–∫—Å—Ç –æ–∑–≤—É—á–∫–∏"
            },
            "hashtags": ["#—Ç–µ–≥1", "#—Ç–µ–≥2"],
            "music_suggestion": "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –º—É–∑—ã–∫–∏"
          }
        ]
      }
    ],
    "stats": {
      "total_tokens": 1250,
      "total_time": 15.5,
      "posts_processed": 1,
      "scenarios_generated": 2
    }
  }
}
```

---

## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞

–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–æ—Ç–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ—Å—Ç–∞.

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/llm/generate-scenarios`

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** API Key

### Request Body

```json
{
  "post_data": {
    "text": "–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞...",
    "analysis": {
      "success_factors": ["–§–∞–∫—Ç–æ—Ä 1"],
      "audience_insights": ["–ò–Ω—Å–∞–π—Ç 1"]
    }
  },
  "rubric": {
    "id": "instrument_dnya",
    "name": "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –î–Ω—è",
    "description": "–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–∑–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞"
  },
  "format": {
    "id": "talking_head",
    "name": "–ì–æ–≤–æ—Ä—è—â–∞—è –ì–æ–ª–æ–≤–∞",
    "duration_seconds": 60,
    "description": "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç —Å –≥–æ–≤–æ—Ä—è—â–∏–º –ª–∏—Ü–æ–º"
  },
  "combination": {
    "justification": "–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏",
    "content_idea": "–ò–¥–µ—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —ç—Ç–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏"
  }
}
```

---

## –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏.

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/llm/process-enhanced`

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** API Key

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä—É–±—Ä–∏–∫ –∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/prompts`

```json
{
  "success": true,
  "data": [
    {
      "name": "filter_posts_system",
      "title": "–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤",
      "category": "analysis",
      "model": "gpt-4o-mini",
      "is_active": true,
      "updated_at": "2024-12-01T10:00:00Z"
    }
  ]
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/prompts/{template_name}`

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `PUT /api/prompts/{template_name}`

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** API Key (–∞–¥–º–∏–Ω)

```json
{
  "system_prompt": "–ù–æ–≤—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç",
  "user_prompt": "–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç",
  "model_settings": {
    "model": "gpt-4o",
    "temperature": 0.8,
    "max_tokens": 2000
  }
}
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/prompts/test/{template_name}`

```json
{
  "variables": {
    "post_text": "–¢–µ–∫—Å—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",
    "channel_title": "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞"
  }
}
```

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –∏–∑ –ë–î

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/prompts/db`

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –ø–æ ID

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/prompts/db/{prompt_id}`

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/prompts`

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `PUT /api/prompts/db/{prompt_id}`

### –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `DELETE /api/prompts/db/{prompt_id}`

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –ø—Ä–æ–º–ø—Ç–æ–≤

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/llm/test/{template_name}`

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** API Key (–∞–¥–º–∏–Ω)

### Request Body

```json
{
  "variables": {
    "post_text": "–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",
    "analysis": "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞",
    "rubric_name": "–ù–∞–∑–≤–∞–Ω–∏–µ —Ä—É–±—Ä–∏–∫–∏",
    "format_name": "–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞"
  },
  "model_override": "gpt-4o"
}
```

### Response

```json
{
  "success": true,
  "data": {
    "template_name": "generate_scenario_system",
    "input_variables": {...},
    "output": "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç...",
    "tokens_used": 450,
    "processing_time": 2.1,
    "model_used": "gpt-4o"
  }
}
```

---

## –ü—Ä–æ–µ–∫—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/context/project`

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `PUT /api/context/project`

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** API Key (–∞–¥–º–∏–Ω)

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è LLM

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/stats/llm`

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** API Key (–∞–¥–º–∏–Ω)

### Response

```json
{
  "success": true,
  "data": {
    "total_requests": 1250,
    "total_tokens": 45000,
    "avg_response_time": 3.2,
    "error_rate": 0.05,
    "model_usage": {
      "gpt-4o": 650,
      "gpt-4o-mini": 450,
      "claude-3-sonnet": 150
    },
    "daily_stats": [
      {
        "date": "2024-12-01",
        "requests": 45,
        "tokens": 1200,
        "errors": 1
      }
    ]
  }
}
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/stats/tokens`

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** API Key (–∞–¥–º–∏–Ω)

### Query Parameters

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `user_id` | string | –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é |
| `days` | integer | –ü–µ—Ä–∏–æ–¥ –≤ –¥–Ω—è—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30) |

---

## –ö–æ–¥—ã –æ—à–∏–±–æ–∫

| –ö–æ–¥ –æ—à–∏–±–∫–∏ | HTTP Status | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|-------------|----------|
| `INVALID_PROMPT_TEMPLATE` | 400 | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —à–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞ |
| `MODEL_NOT_AVAILABLE` | 503 | –ú–æ–¥–µ–ª—å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ |
| `QUOTA_EXCEEDED` | 429 | –ü—Ä–µ–≤—ã—à–µ–Ω–∞ –∫–≤–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
| `CONTENT_FILTERED` | 400 | –ö–æ–Ω—Ç–µ–Ω—Ç –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π |
| `PROMPT_TOO_LONG` | 400 | –ü—Ä–æ–º–ø—Ç –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤ |
| `INVALID_VARIABLES` | 400 | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —à–∞–±–ª–æ–Ω–∞ |

---

## Rate Limiting –¥–ª—è LLM

| –û–ø–µ—Ä–∞—Ü–∏—è | –õ–∏–º–∏—Ç | –ü–µ—Ä–∏–æ–¥ |
|----------|--------|--------|
| –ê–Ω–∞–ª–∏–∑ –ø–æ—Å—Ç–∞ | 100 | —á–∞—Å |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è | 50 | —á–∞—Å |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ | 20 | —á–∞—Å |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏ | 200 | —á–∞—Å |

---

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤
```python
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
prompt_vars = {
    "post_text": post.text[:2000],  # –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–ª–∏–Ω—É
    "analysis": json.dumps(analysis_data),
    "rubric_name": rubric.get('name', ''),
    "format_name": format.get('name', '')
}
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```python
try:
    result = await api.llm_process(post_data)
except Exception as e:
    if "quota_exceeded" in str(e):
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –∫–≤–æ—Ç—ã
        await asyncio.sleep(60)  # –û–∂–∏–¥–∞–Ω–∏–µ
        result = await api.llm_process(post_data)
    elif "model_unavailable" in str(e):
        # Fallback –Ω–∞ –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å
        result = await api.llm_process(post_data, model="gpt-4o-mini")
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```python
# –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–µ–≥—É–ª—è—Ä–Ω–æ
stats = await api.get_llm_stats()
if stats['error_rate'] > 0.1:
    logger.warning("–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—à–∏–±–æ–∫ LLM")

if stats['avg_response_time'] > 10:
    logger.warning("–ó–∞–º–µ–¥–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ LLM")
```

---

*–û–±–Ω–æ–≤–ª–µ–Ω–æ: –î–µ–∫–∞–±—Ä—å 2024 | –í–µ—Ä—Å–∏—è API: 1.0.0*
